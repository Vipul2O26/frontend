<app-header></app-header>

<div class="container py-5" [class.dark-mode]="isDarkMode">
  <h2 class="text-center mb-4">ðŸ“‹ Task Dashboard</h2>

  <!-- Dark Mode Toggle -->
  <div class="text-end mb-3">
    <button class="btn btn-sm btn-outline-secondary" (click)="toggleDarkMode()">
      ðŸŒ“ Toggle Dark Mode
    </button>
  </div>

  <!-- Add Task -->
  <div class="text-end mb-3">
    <a routerLink="/task-form" class="btn btn-primary">âž• Add Task</a>
  </div>

  <!-- Table -->
  <div class="table-responsive border rounded">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-light text-center">
        <tr>
          <th>Title</th>
          <th>Priority</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of tasks()">
          <td>{{ task.title }}</td>
          <td>
            <span class="badge"
              [ngClass]="{
                'bg-danger': task.priority === 'High',
                'bg-warning text-dark': task.priority === 'Medium',
                'bg-success': task.priority === 'Low'
              }">
              {{ task.priority }}
            </span>
          </td>
          <td>{{ task.dueDate | date: 'mediumDate' }}</td>
          <td>
            <span class="badge"
              [ngClass]="{
                'bg-success': task.isCompleted,
                'bg-secondary': !task.isCompleted
              }">
              {{ task.isCompleted ? 'Completed' : 'Pending' }}
            </span>
          </td>
          <td class="text-center">
            <a [routerLink]="['/task-form']" [queryParams]="{ id: task.id }" class="btn btn-sm btn-outline-primary me-1">Edit</a>
            <button (click)="deleteTask(task.id)" class="btn btn-sm btn-outline-danger">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal fade show d-block" *ngIf="showModal" style="background: rgba(0, 0, 0, 0.5)">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this task?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
          <button class="btn btn-danger" (click)="deleteConfirmed()">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast show position-fixed bottom-0 end-0 m-4 text-bg-success" *ngIf="showToast" style="z-index: 1055">
    <div class="d-flex">
      <div class="toast-body">
        {{ toastMessage }}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="showToast = false"></button>
    </div>
  </div>

  <!-- Pie Chart -->
  <div class="my-4 text-center">
    <h4>ðŸ“Š Task Priority Distribution</h4>
    <div style="width: 200px; height: 200px; margin: auto;">
      <canvas id="taskChart"></canvas>
    </div>
  </div>
</div>


<app-footer></app-footer>